machine:
  timezone: Asia/Tokyo
  java:
    version: oraclejdk7
  node:
    version: 0.10.32
  pre:
    - git config --global user.name "CircleCI"
    - git config --global user.email "circleci@example.com"
  post:
    - echo -e $PGP_KEY > ~/sec.key
    - gpg --import --allow-secret-key-import ~/sec.key
    - rm ~/sec.key
    - mkdir -p ~/.gradle
    - echo 'signing.keyId=CC041648' > ~/.gradle/gradle.properties

dependencies:
  cache_directories:
    - ~/.gradle
    - ~/.sbt
    - ~/.ivy2
    - ~/.m2
    - ~/nvm
  override:
    - node -v
    - npm install -y grunt-cli bower
    - ./gradlew install -x signArchives:
        pwd: aeromock-dsl
    - npm install:
        pwd: aeromock-view
    - grunt build:
        pwd: aeromock-view


test:
  override:
    - sbt coveralls

notify:
  webhooks:
    - url: https://webhooks.gitter.im/e/73037938e5ad665bdbd5

deployment:
  snapshot:
    branch: /.+-snapshot$/
    owner: CyberAgent
    commands:
      - ./aeromock-dsl/gradlew -p aeromock-dsl uploadArchives
      - sbt publishSigned
